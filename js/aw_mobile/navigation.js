var useDblClick=true;var debug=false;var dumbLoop=null;var canGo=true;var lastElement=null;var _touchMutex=true;var _isParking=false;var catPath=new Array();var catUrl=new Array();var homeCatId=null;var _tempTimer=null;var _tapCatId=null;var _tapCount=0;var _clickTimer=null;var _drag=false;var _startX,_startY,_lastX,_lastY=0;var debugMessage=function(a){$j("div.debug").html(a+" CG = "+(canGo?"true":"false")+"<br />drag = "+(_drag?"true":"false"))};var tapMe=function(a){if(debug){debugMessage("Tap")}};var hideMessages=function(){if($j("ul.messages")){$j("ul.messages").addClass("hidden")}};var setContainerHeight=function(b){if(typeof(b)!="undefined"){$j("div.header-nav-container").height(b);if($j.support.isAndroid||$j.support.isBlackBerry){var a=$j(window).height()-$j("div.footer-container").height()-$j("div.header-top").height()-$j("div.shop-access").height();if($j("div.header-nav-container").height()<a){$j("div.header-nav-container").height(a)}scrollTo(0,0)}}};function pause(c){var b=new Date();var a=null;do{a=new Date()}while(a-b<c)}var dumbLoopStart=function(){dumbLoop=setInterval(function(){var a=$j("div.current").attr("id");if((location.hash=="")){location.hash="#"+a}else{if((location.hash!="#"+a)){try{if(canGo){navigation.goBack()}}catch(b){}}}},100)};var setNavLeft=function(a,b){if(debug){debugMessage("setting left = "+b+"px")}if(a&&a.attr("id")){$(a.attr("id")).style.webkitTransform="translate3d("+b+"px, 0, 0)"}};var hasHistory=function(){return(navigation.history.length>0)};var getLastFromHistory=function(){if(hasHistory()){return navigation.history[navigation.history.length-1]}return null};var restoreHistory=function(b){if(typeof(catPath[b])!="undefined"){var a=catPath[b].split("/");var c=false;$(a).each(function(d){if(d==homeCatId){navigation.history.push($j("div#home"));c=true}else{if(c){if(d!=$($j("div.current").attr("id")).category_id){navigation.history.push($j("div#category"+d))}}}});return true}return false};var MobileNavigation=Class.create();MobileNavigation.prototype={initialize:function(){this.touchSelector="a.to_child";this.tapSelector="li.arrow a";this.history=new Array();setContainerHeight($j("div.current").height());if(debug){debugMessage("Init navigation")}if(!$j.support.isMobile){$j(document).ready(function(a){$j("li.arrow a").each(function(c,b){$j(b).mouseover(function(d){$j(this).addClass("hover")});$j(b).mouseout(function(d){$j(this).removeClass("hover")})})})}$j(document).bind("ready",{self:this},function(b){var f=b.data.self.touchSelector;var a=b.data.self.tapSelector;if(debug){}if($j.support.touch||$j.support.isMobile){$j(a).bind("touchstart",{self:b.data.self},function(k){var j=setInterval(function(l){if(_touchMutex){navigation.resetOver();$j(k.target).addClass("hover");_tempTimer=setInterval(function(m){_touchMutex=true;clearInterval(_tempTimer);_tempTimer=null},500)}else{$j("li.arrow a.hover").removeClass("hover");_tempTimer=setInterval(function(m){_touchMutex=true;clearInterval(_tempTimer);_tempTimer=null},500)}clearInterval(j);j=false},150)})}$j(f).bind("click",{self:b.data.self},function(j){j.data.self.handleClick(j.currentTarget);return false});if((document.location.hash!="")&&(document.location.hash!="#home")&&(document.location.hash!="#cart")){$j("div.current").removeClass("current");$j("div"+document.location.hash).addClass("current");setContainerHeight($j("div.current").height());if(typeof(document.getElementById($j("div.current").attr("id")).category_id)!="undefined"){restoreHistory(document.getElementById($j("div.current").attr("id")).category_id)}}else{if(document.location.hash=="#cart"){$j(document).ready(function(){$j("div.content-container").addClass("hidden");$j("div.cart-container").removeClass("hidden")})}else{document.location.hash="home"}}dumbLoopStart();var e=function(){canGo=false;clearInterval(dumbLoop);$j("div.current").addClass("drag");if(hasHistory()){lastElement=getLastFromHistory();if(lastElement.height()>$j("div.header-nav-container").height()){setContainerHeight(lastElement.height())}setNavLeft(lastElement,-getScreenWidth());lastElement.addClass("visible")}_drag=true};var g=function(k,j){var l=Math.round(((Math.abs(k)-Math.abs(j)))/(Math.abs(k))*100);if(debug){debugMessage("drag = "+(_drag?"true":"false"))}if((k>0)&&(l>90)&&(_drag==false)){e()}if((k>0)&&hasHistory()&&(_drag==true)){setNavLeft($j("div.current"),k);setNavLeft(lastElement,k-getScreenWidth())}};var d=function(j){if(_drag==true){setNavLeft($j("div.current"),0);if(lastElement!==null){setNavLeft(lastElement,0);lastElement.removeClass("visible")}if(j>Math.round(getScreenWidth()/3)){canGo=true;navigation.goBack(j)}else{_isParking=true;navigation.parking()}setContainerHeight($j("div.current").height());canGo=true;_drag=false}};if($j.support.touch||$j.support.isMobile){var h=function(j){$j(j.changedTouches).each(function(){if(j.targetTouches.length>1){return false}_lastX=_startX=this.pageX;_lastY=_startY=this.pageY;if(useDblClick){if(_isAnimate){return false}var k=0;if(typeof(j.target.hash)!="undefined"){k=j.target.hash.replace("#category","")}if(_clickTimer!==null){_tapCount++}else{_tapCatId=k;_tapCount=1;_clickTimer=setInterval(function(m){if(_tapCount>=2){if(k>0){window.location=catUrl[k]}else{var l=j.target.toString();if(l.length&&l[0]!="["){window.location=j.target}}}_tapCatId=null;_tapCount=0;clearInterval(_clickTimer);_clickTimer=null},300)}}if(debug){debugMessage("Touch started!");$j("div.debug").addClass("red")}})};var i=function(j){$j(j.changedTouches).each(function(){if(!j.targetTouches.length){if(debug){debugMessage("Touch finished!");$j("div.debug").removeClass("red")}var k=_lastX-_startX;d(k);_touchMutex=false;navigation.resetOver()}})};var c=function(j){$j(j.changedTouches).each(function(){_lastX=this.pageX;var l=this.pageX-_startX;var k=this.pageY-_startY;if((Math.abs(k)>0)||(Math.abs(l)>0)){_touchMutex=false}g(l,k);if(debug){var m="dX = "+l+"px; dY = "+k+"px";m+="<br />";debugMessage(m)}return false})};$j("#main").each(function(){this.ontouchstart=h;this.ontouchend=i;this.ontouchmove=c})}})},animateNavigation:function(e,d,a){if(!canGo){return false}var c="slide";if(d.length===0){return false}if(debug){debugMessage("Animation"+(a?"back":""))}if(d.height()>e.height()){if(debug){}setContainerHeight(d.height())}$j(":focus").blur();var b=function(g){e.removeClass("current out reverse "+c);d.removeClass("in reverse "+c+" animated");e.trigger("pageAnimationEnd",{direction:"out"});d.trigger("pageAnimationEnd",{direction:"in"});setNavLeft(d,0);if(debug){debugMessage("try to set height")}setContainerHeight(d.height());clearInterval(dumbLoop);currentPage=d;location.hash=currentPage.attr("id");dumbLoopStart();var f=d.data("referrer");if(f){f.unselect()}lastAnimationTime=(new Date()).getTime();if(debug){debugMessage("Animation end.")}navigation.resetOver();canGo=true;hideMessages()};if($j.support.WebKitAnimationEvent){canGo=false;d.removeClass("drag touchBack");e.removeClass("drag touchBack");setNavLeft(d,0);setNavLeft(e,0);d.one("webkitAnimationEnd",b);e.addClass(c+" out"+(a?" reverse":""));d.addClass("current");d.addClass(c+" in"+(a?" reverse":""))}else{d.addClass("current");b()}return true},goBack:function(a){if((this.history.length>0)&&canGo){targetPage=this.history.pop();currentPage=$j("div.current");if(a>0){var b=function(c){targetPage.removeClass("touchBack drag");currentPage.removeClass("touchBack drag");if(debug){debugMessage("Transition finished!")}setContainerHeight(targetPage.height());setNavLeft(targetPage,0);setNavLeft(currentPage,0);clearInterval(dumbLoop);document.location.hash="#"+$j("div.current").attr("id");dumbLoopStart();navigation.resetOver();canGo=true;return false};canGo=false;targetPage.one("webkitTransitionEnd",b);targetPage.addClass("touchBack current");currentPage.addClass("touchBack").removeClass("current");setNavLeft(targetPage,0);setNavLeft(currentPage,-getScreenWidth());if(debug){debugMessage("Transition started!")}}else{this.animateNavigation(currentPage,targetPage,true);return false}}return true},parking:function(){if((this.history.length>0)&&_isParking){canGo=false;var b=$j("div.current");var a=getLastFromHistory();var c=function(d){a.removeClass("parking drag");b.removeClass("parking drag");canGo=true;_isParking=false;navigation.resetOver()};b.one("webkitTransitionEnd",c);b.addClass("parking");a.addClass("parking");setNavLeft(b,0);setNavLeft(a,-getScreenWidth())}},handleClick:function(b){currentPage=$j("div.current");targetPage=$j("div"+b.hash);if(!$j.support.isMobile){if(useDblClick){if(_isAnimate){return false}var a=b.hash.replace("#category","");if(_clickTimer!==null){_tapCount++}else{_tapCatId=a;_tapCount=1;_clickTimer=setInterval(function(c){if(_tapCount>=2){window.location=catUrl[a]}else{navigation.navigate(currentPage,targetPage)}_tapCatId=null;_tapCount=0;clearInterval(_clickTimer);_clickTimer=null},300)}}else{this.navigate(currentPage,targetPage)}}else{this.navigate(currentPage,targetPage)}},navigate:function(a,b){this.history.push(a);this.animateNavigation(a,b,false)},resetOver:function(){$j("li.arrow a.hover").removeClass("hover");$j("div.parking").removeClass("parking");$j("div.touchBack").removeClass("touchBack");_touchMutex=true}};;
