var _isAnimate=false;var _isDeleteActivate=false;var _debug=false;var _ajaxTimeout=10000;var oldHash;var cartAnimate=function(f,e,d,c){if($j.support.WebKitAnimationEvent){var b=$("footer-container");var a=function(g){f.trigger("pageAnimationEnd",{direction:"out"});e.trigger("pageAnimationEnd",{direction:"in"});f.removeClass("animation from").removeClass(d).addClass("hidden");e.removeClass("animation to").removeClass(d).addClass("active");$j("div#footer-container").removeClass("animation");_isAnimate=false;if(d=="left"){mobileCart.updateOverlayHeights()}if(c){c()}};e.one("webkitAnimationEnd",a);f.removeClass("active");if(f.height()>e.height()){b.style.top=(f.height()+1)+"px"}else{b.style.top=(e.height()+1)+"px"}$j("div#footer-container").addClass("animation");e.removeClass("hidden");e.addClass("animation to").addClass(d);f.addClass("animation from").addClass(d)}else{f.removeClass("active").addClass("hidden");e.removeClass("hidden").addClass("active");_isAnimate=false;if(d=="left"){mobileCart.updateOverlayHeights()}if(c){c()}}};var goToCart=function(a){if(_isAnimate){return false}_isAnimate=true;cartAnimate($j("div.content-container"),$j("div.cart-container"),"left",a);oldHash=document.location.hash;document.location.hash="#cart"};var cartBack=function(a){if(_isAnimate){return false}_isAnimate=true;cartAnimate($j("div.cart-container"),$j("div.content-container"),"right",a);if(oldHash!="#cart"){document.location.hash=oldHash}else{document.location.hash=""}};var _isLocalAnimate=false;var animateItemOverlay=function(d,a){if(false){if(_isLocalAnimate){return false}_isLocalAnimate=true;var c=d.attr("id");var b="button-"+c;if(a){$(c).style.opacity="1.0";$(c).style.display="block";$j("div#"+b).width("0px");var e=setInterval(function(){var g=function(h){$j("div#"+b).removeClass("trans-button");_isLocalAnimate=false};$j("div#"+b).addClass("trans-button");$j("div#"+b).one("webkitTransitionEnd",g);$j("div#"+b).width("65px");clearInterval(e)},100)}else{d.removeClass("active");$(c).style.opacity="1.0";$(c).style.display="block";$(b).style.width="65px";var f=function(h){$j("div#"+b).removeClass("trans-button");var g=function(i){$j("div#"+c).removeClass("trans-overlay");mobileCart.activeItem=null;_isLocalAnimate=false};$j("div#"+c).addClass("trans-overlay");$j("div#"+c).one("webkitTransitionEnd",g);$(c).style.opacity="0.0"};$j("div#"+b).one("webkitTransitionEnd",f);$j("div#"+b).addClass("trans-button");$(b).style.width="0px"}}else{if(a){d.show()}else{d.hide();mobileCart.activeItem=null}}};var posToScreenCenter=function(b){var a=$j(window).height();b.css({top:(a/2-12+window.scrollY)+"px"})};var callInProgress=function(a){switch(a.readyState){case 1:case 2:case 3:return true;break;default:return false;break}};var ajaxWrapper=function(a,c,b){if(_debug){console.log("Ajax wrapper")}if(typeof(b)=="function"){b()}Ajax.Responders.register({onCreate:function(d){d.awMobileTimeoutId=window.setTimeout(function(){if(callInProgress(d.transport)){if(_debug){console.log("Exit for timeout")}d.transport.abort();if(d.options.onFailure){d.options.onFailure(d.transport,d.json)}}},_ajaxTimeout)},onComplete:function(d){window.clearTimeout(d.awMobileTimeoutId)}});new Ajax.Request(mobileCart.prepareUrl(a),c)};var MobileCart=Class.create();MobileCart.prototype={initialize:function(){this.activeItem=null},registerGiftcard:function(a,b){this.giftcard_form=$j("#"+a);this.giftcard_form_id=a;this.giftcardFormSubmitUrl=b;this.giftcard_form.submit(function(c){mobileCart.postGiftcardForm();return false})},registerCoupon:function(a,b){this.coupon_form=$j("#"+a);this.coupon_form_id=a;this.couponFormSubmitUrl=b;this.coupon_form.submit(function(c){mobileCart.postCouponForm();return false})},registerSubmit:function(c,b){this.form=$j("#"+c);this.form_id=c;this.formSubmitUrl=b;this.activeItem=null;this.form.submit(function(d){mobileCart.postCartForm();return false});$j("div.cart-item-overlay").click(function(d){mobileCart.disableAllOverlays()});$j("div.cart-row").click(function(d){mobileCart.disableAllOverlays()});var a=0;$j("tr.cart-row").each(function(e,d){if($j.support.touch||$j.support.isMobile){$(d).addEventListener("touchstart",function(f){if(_isAnimate){return false}this.lastX=this.startX=f.targetTouches[0].clientX},false);$(d).addEventListener("touchend",function(f){if(_isAnimate){return false}a=this.lastX-this.startX},false);$(d).addEventListener("touchmove",function(g){if(_isAnimate){return false}this.lastX=g.targetTouches[0].clientX;var f=g.targetTouches[0].clientX-this.startX;if(f>50){mobileCart.disableAllOverlays();mobileCart.activeItem=$j("div#overlay-"+$j(this).attr("id"));animateItemOverlay($j("div#overlay-"+$j(this).attr("id")),true);_isDeleteActivate=true}return false},false)}else{$(d).addEventListener("dblclick",function(f){mobileCart.disableAllOverlays();mobileCart.activeItem=$j("div#overlay-"+$j(this).attr("id"));_isDeleteActivate=true;animateItemOverlay($j("div#overlay-"+$j(this).attr("id")),true)},false)}})},disableAllOverlays:function(){if(this.activeItem!=null){animateItemOverlay(this.activeItem,false)}_isDeleteActivate=false},prepareUrl:function(a){var b=a;if(typeof(b)!="undefined"){return b.replace(/^http[s]{0,1}/,window.location.href.replace(/:[^:].*$/i,""))}else{return a}},setLoader:function(a,b){if(a){posToScreenCenter($j("div.cart-loader"));showOverlay(b,true)}else{hideOverlay(b,true)}},updateContent:function(transport){try{response=eval("("+transport.responseText+")");if(response.cart_content){$("main-cart").innerHTML=response.cart_content}if(response.link_content){$("gotocart-button-container").innerHTML=response.link_content}var cartNotEmpty=$("cart-form") instanceof Object;$$("#checkout-button").invoke(cartNotEmpty?"show":"hide");if(response.error){console.debug(response.error)}}catch(e){response={}}mobileCart.registerSubmit(mobileCart.form_id,mobileCart.formSubmitUrl);mobileCart.registerCoupon(mobileCart.coupon_form_id,mobileCart.couponFormSubmitUrl)},postProductForm:function(b,a){goToCart(function(){ajaxWrapper(a,{method:"post",onSuccess:function(c){if(c&&c.responseText){mobileCart.updateContent(c);mobileCart.setLoader(false)}},onFailure:function(){mobileCart.setLoader(false)},parameters:Form.serialize($(b))},function(){mobileCart.setLoader(true)})})},postGiftcardForm:function(a){mobileCart.disableAllOverlays();mobileCart.setLoader(true);var b=this.giftcardFormSubmitUrl;if(typeof(a)!="undefined"){b=a}ajaxWrapper(b,{method:"post",onSuccess:function(c){if(c&&c.responseText){mobileCart.updateContent(c);mobileCart.setLoader(false)}},onFailure:function(){mobileCart.setLoader(false)},parameters:Form.serialize($(this.giftcard_form_id))})},postCouponForm:function(a){if(a){$("coupon_code").removeClassName("required-entry");$("remove-coupone").value="1"}else{$("coupon_code").addClassName("required-entry");$("remove-coupone").value="0"}mobileCart.disableAllOverlays();mobileCart.setLoader(true);ajaxWrapper(this.couponFormSubmitUrl,{method:"post",onSuccess:function(b){if(b&&b.responseText){mobileCart.updateContent(b);mobileCart.setLoader(false)}},onFailure:function(){mobileCart.setLoader(false)},parameters:Form.serialize($(this.coupon_form_id))})},postCartForm:function(){mobileCart.disableAllOverlays();mobileCart.setLoader(true);ajaxWrapper(this.formSubmitUrl,{method:"post",onSuccess:function(a){if(a&&a.responseText){mobileCart.updateContent(a);mobileCart.setLoader(false)}},onFailure:function(){mobileCart.setLoader(false)},parameters:Form.serialize($(this.form_id))})},loadUpdatedCart:function(){mobileCart.setLoader(true);ajaxWrapper(this.contentUrl,{method:"get",onSuccess:function(a){if(a&&a.responseText){mobileCart.updateContent(a);mobileCart.setLoader(false)}},onFailure:function(){mobileCart.setLoader(false)}})},updateOverlayHeights:function(){$j("div.cart-item-overlay").each(function(b,a){if(a.parentNode.offsetHeight>0){$j(a).height(a.parentNode.offsetHeight-1)}})},deleteItem:function(a){mobileCart.disableAllOverlays();mobileCart.setLoader(true);ajaxWrapper(a,{method:"get",onSuccess:function(b){if(b&&b.responseText){mobileCart.updateContent(b);mobileCart.setLoader(false)}},onFailure:function(){mobileCart.setLoader(false)}});return false}};if(typeof(mobileCart)=="undefined"){var mobileCart=new MobileCart()}$j(document).ready(function(){$j(document).bind("checkorientationchange",function(){mobileCart.updateOverlayHeights()});if(window.localStorage.getItem("awmobile_cart")=="true"){window.localStorage.setItem("awmobile_cart","false");window.location.hash="#cart"}oldHash=window.location.hash;if(window.location.hash=="#cart"){goToCart()}setLocation=function(a){if(window.location.hash=="#cart"){a+=window.location.hash;window.localStorage.setItem("awmobile_cart","true")}window.location.href=a}});var onClickDocument=function(a){if((mobileCart.activeItem!=null)&&!$j(a.target).hasClass("cart-item-overlay")&&!$j(a.target).hasClass("delete")&&!$j(a.target.parentNode).hasClass("delete")){mobileCart.disableAllOverlays()}};if($j.support.touch){document.addEventListener("touchstart",function(a){onClickDocument(a);return true},false)}else{document.addEventListener("click",function(a){onClickDocument(a);return true},false)}$j(document).bind("hideoverlaycomplete",function(){mobileCart.updateOverlayHeights()});;
